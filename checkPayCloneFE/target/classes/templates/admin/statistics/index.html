<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>관리자 페이지</title>

	<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
	
	<!-- [S] chart -->
	<script src="../../js/highcharts/highcharts.js"></script>
	<script src="../../js/highcharts/modules/exporting.js"></script>
	<script src="../../js/highcharts/modules/export-data.js"></script>
	<!-- [E] chart -->
	
	<!-- custom jquery -->
	<script src="../../js/common.js"></script> 
	<script src="../../js/adminCommon.js"></script>
	<script src="../../js/admin/statistics/memberChart1.js"></script>
	<script src="../../js/admin/statistics/memberChart2.js"></script>
	<script src="../../js/admin/statistics/assetChart1.js"></script>
	<script src="../../js/admin/statistics/assetChart2.js"></script>
	<script src="../../js/admin/statistics/bankChart.js"></script>
	<script src="../../js/admin/statistics/cardChart.js"></script>
	<script src="../../js/admin/statistics/efinChart.js"></script>
	<script src="../../js/admin/statistics/investChart.js"></script>
	<script src="../../js/admin/statistics/telecomChart.js"></script>
	<script src="../../js/admin/statistics/capitalChart.js"></script>

	<!-- css -->
	<link href="../../css/admin/common.css" rel="stylesheet">
	<link href="../../css/admin/statistics/index.css" rel="stylesheet">
	</head>
	
	<body>
        <div id="header">
            <div class="logo"></div>
        </div>
        <div id="navigation">
            <div class="nav-container">
				<div class="nav-item"><span class="glyphicon glyphicon-home"></span><a href="/admin/home">홈</a></div>
                <div class="nav-item"><span class="glyphicon glyphicon-user"></span><a href="/admin/member/">회원 관리</a></div>
                <div class="nav-item"><span class="glyphicon glyphicon-bullhorn"></span><a href="/admin/notice/">공지사항 관리</a></div>
                <div class="nav-item active"><span class="glyphicon glyphicon-signal"></span><a href="/admin/statistics/">통계</a></div>
            </div>
            <div class="logout" data-toggle="modal" data-target="#logout-modal">
                <span class="glyphicon glyphicon glyphicon-log-out" aria-hidden="true"></span>
            </div>
        </div>
        <div id="main">
			
			<!-- 회원 통계 -->
            <div class="panel panel-default">
                <!-- Default panel contents -->
                <div class="panel-heading">회원 통계</div>
				<div class="chart-wrap">
					<div class="chart-container">
						<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
	                        aria-describedby="chartDescId">
	                        <div id="memberChart1"></div>
	                    </figure>
                    </div>
                    <div class="chart-container">
	                    <select id="memberChart2Data_selectYear" class="chart-select">
	                        <option value="2023" selected>2023년</option>
	                        <option value="2022">2022년</option>
	                        <option value="2021">2021년</option>
	                    </select>
	                    <figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
	                        aria-describedby="chartDescId">
	                        <div id="memberChart2"></div>
	                    </figure>
	                </div>
				</div>

            </div>
            
            <!-- 자산 통계 -->
                <div class="panel panel-default">
					<!-- Default panel contents -->
                	<div class="panel-heading">자산 통계</div>
                	<div class="chart-wrap">
						<div class="chart-container">
							<select id="assetChart1Data_selectYear" class="chart-select">
		                        <option value="2023" selected>2023년</option>
		                        <option value="2022">2022년</option>
		                        <option value="2021">2021년</option>
		                    </select>
							<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
		                        aria-describedby="chartDescId">
		                        <div id="assetChart1"></div>
		                    </figure>
	                    </div>
	                    <div class="chart-container">
		                    <figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
		                        aria-describedby="chartDescId">
		                        <div id="assetChart2"></div>
		                    </figure>
		                </div>
					</div>
				</div>
				
			<!-- 은행 업권 통계 -->
            <div class="panel panel-default">
				<!-- Default panel contents -->
            	<div class="panel-heading">은행 업권 통계</div>
            	<div class="chart-wrap">
					<select id="bankChartData_selectYear" class="chart-select">
		                        <option value="2023" selected>2023년</option>
		                        <option value="2022">2022년</option>
		                        <option value="2021">2021년</option>
		                    </select>
					<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
                        aria-describedby="chartDescId">
                        <div id="bankChart"></div>
                    </figure>
				</div>
			</div>
			
			<!-- 카드 업권 통계 -->
            <div class="panel panel-default">
				<!-- Default panel contents -->
            	<div class="panel-heading">카드 업권 통계</div>
            	<div class="chart-wrap">
					<select id="cardChartData_selectYear" class="chart-select">
		                        <option value="2023" selected>2023년</option>
		                        <option value="2022">2022년</option>
		                        <option value="2021">2021년</option>
		                    </select>
					<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
                        aria-describedby="chartDescId">
                        <div id="cardChart"></div>
                    </figure>
				</div>
			</div>
			
			<!-- 선불/페이 업권 통계 -->
            <div class="panel panel-default">
				<!-- Default panel contents -->
            	<div class="panel-heading">선불/페이 업권 통계</div>
            	<div class="chart-wrap">
					<select id="efinChartData_selectYear" class="chart-select">
		                        <option value="2023" selected>2023년</option>
		                        <option value="2022">2022년</option>
		                        <option value="2021">2021년</option>
		                    </select>
					<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
                        aria-describedby="chartDescId">
                        <div id="efinChart"></div>
                    </figure>
				</div>
			</div>
			
			<!-- 증권 업권 통계 -->
            <div class="panel panel-default">
				<!-- Default panel contents -->
            	<div class="panel-heading">증권 업권 통계</div>
            	<div class="chart-wrap">
					<select id="investChartData_selectYear" class="chart-select">
		                        <option value="2023" selected>2023년</option>
		                        <option value="2022">2022년</option>
		                        <option value="2021">2021년</option>
		                    </select>
					<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
                        aria-describedby="chartDescId">
                        <div id="investChart"></div>
                    </figure>
				</div>
			</div>
			
			<!-- 통신 업권 통계 -->
            <div class="panel panel-default">
				<!-- Default panel contents -->
            	<div class="panel-heading">통신 업권 통계</div>
            	<div class="chart-wrap">
					<select id="telecomChartData_selectYear" class="chart-select">
		                        <option value="2023" selected>2023년</option>
		                        <option value="2022">2022년</option>
		                        <option value="2021">2021년</option>
		                    </select>
					<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
                        aria-describedby="chartDescId">
                        <div id="telecomChart"></div>
                    </figure>
				</div>
			</div>
			
			<!-- 대출 업권 통계 -->
            <div class="panel panel-default">
				<!-- Default panel contents -->
            	<div class="panel-heading">대출 업권 통계</div>
            	<div class="chart-wrap">
					<select id="capitalChartData_selectYear" class="chart-select">
		                        <option value="2023" selected>2023년</option>
		                        <option value="2022">2022년</option>
		                        <option value="2021">2021년</option>
		                    </select>
					<figure class="highcharts-figure" role="img" aria-labelledby="chartLabelId"
                        aria-describedby="chartDescId">
                        <div id="capitalChart"></div>
                    </figure>
				</div>
			</div>
			
        </div>
        
        <!-- 로그아웃 모달 시작 -->
    <div class="modal fade" id="logout-modal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">로그아웃</h4>
                </div>
                <div class="modal-body">
                    <p>로그아웃 하시겠습니까?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-danger" id="logout-data" data-toggle="modal"
                        data-target="#logout-msg">로그아웃</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="logout-msg" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">로그아웃</h4>
                </div>
                <div class="modal-body">
                    <p>로그아웃 완료.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id="move-loginPage">확인</button>
                </div>
            </div>
        </div>
    </div>
    <!-- 로그아웃 모달 끝 -->
    
        <div id="bg">
            
        </div>
	</body>
    <script type="text/javascript">
		 	var token = getCookie("jwt");
			var rtk = getCookie("rtk");    
		    var id = parseJwt(getCookie("jwt")).sub;
		    var pageIndex = 1;
		
		    var baseUrl = 'http://192.168.240.208:8081';
		    
		    var dev = false;
		    if(dev){
		        baseUrl = 'http://localhost:8081';
		    }
		    
		    var memberChart1 = null;
		    var memberChart2 = null;
		    var assetChart1 = null;
		    var assetChart2 = null;
		    var bankChart = null;
		    var cardChart = null;
		    var efinChart = null;
		    var investChart = null;
		    var telecomChart = null;
		    var capitalChart = null;
    
		$(function() {
			memberChart1 = getMemberChart1();
			memberChart2 = getMemberChart2();
			assetChart1 = getAssetChart1();
			assetChart2 = getAssetChart2();
			bankChart = getBankChart();
			cardChart = getCardChart();
			efinChart = getEfinChart();
			investChart = getInvestChart();
			telecomChart = getTelecomChart();
			capitalChart = getCapitalChart();
			
			//임시 로그아웃 처리
		    $('#logout-data').click(function () {
		        $('#logout-modal').remove();
		        $('#move-loginPage').click(function () {
		            $.ajax({
		                url: baseUrl + "/api/login/logout",
		                type: 'post',
		                data: {
		                    "rtk": rtk
		                },
		                success: function () {
		                    deleteCookie('jwt');
		                    deleteCookie('rtk');
		                    window.location.href = "/admin/login";
		                },
		                error: function (jqXHR) {
		                    console.log("로그아웃 error" + jqXHR.status);
		                }
		            });
		        })
		    })
		})
		
		/*
		년도 선택에 따른 통계 데이터 불러와서 차트 반영
		*/
		$(document).on('change', 'select.chart-select', async function () {
			var id = $(this)[0].id;
			var data = null;
			
			switch(id){
				 // 회원 통계 - 월별 사용자 통계
				case 'memberChart2Data_selectYear':
					data = getMemberChart2Data();

		    		memberChart2.series[0].setData(data);
					break;
				 // 자산 통계 - 월별 회원 평균 자산 변동 통계
				case 'assetChart1Data_selectYear':
					data = getAssetChart1Data();
		   
		    		assetChart1.series[0].setData(data);
					break;
				 // 은행 업권 통계 - 월별 평균 입출금 금액
				case 'bankChartData_selectYear':
					data = getBankChartData();

		    		bankChart.series[0].setData(data[0]);
		    		bankChart.series[1].setData(data[1]);
					break;
				// 카드 업권 통계 - 월별 카테고리 별 지출 비율
				case 'cardChartData_selectYear':
					data = getCardChartData();
					
					cardChart.series.map((value, index)=>{
						value.setData([]);
					})
			
					cardChart.update({
						xAxis:{
							categories:data.categories
						},
						series:data.series
					});

					break;
				// 선불/페이 업권 통계 - 월별 평균 선불/페이 입출금 변동 추이
				case 'efinChartData_selectYear':
					data = getEfinChartData();
		   
		    		efinChart.series[0].setData(data[0]);
		    		efinChart.series[1].setData(data[1]);
					break;
				// 증권 업권 통계 - 월별 평균 투자 금액 변동 추이
				case 'investChartData_selectYear':
					data = getInvestChartData();
		   
		    		investChart.series[0].setData(data[0]);
					break;
				// 통신 업권 통계 - 월별 평균 청구 금액
				case 'telecomChartData_selectYear':
					data = getTelecomChartData();
		   
		    		telecomChart.series[0].setData(data);
					break;
				// 대출 업권 통계 - 월별 대출 잔액 변동 추이
				case 'capitalChartData_selectYear':
					data = getCapitalChartData();
		   
		    		capitalChart.series[0].setData(data[0]);
					break;
			}
		});
	</script>
</html>